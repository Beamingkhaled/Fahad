<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>شنسوي الويكند؟ — مُرشِّح الأنشطة</title>
<style>
:root{
  --bg1:#0f1022; --bg2:#132b38;
  --panel:rgba(255,255,255,.06); --stroke:rgba(255,255,255,.14);
  --text:#fff; --muted:#cfd8dc;
  --accent:#ff2bd1; --accent2:#7c3aed;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--text);
  -webkit-text-size-adjust:100%;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Kufi Arabic", "Noto Sans", Arial, sans-serif;
  background:
    radial-gradient(1200px 1200px at 10% -10%, #1e1b4b 0%, transparent 60%),
    radial-gradient(900px 900px at 110% 10%, #0ea5e9 0%, transparent 50%),
    linear-gradient(160deg,var(--bg1),var(--bg2));
  min-height:100vh;            /* fallback */
  min-height:100svh;           /* iOS safe, avoids toolbar jump */
  -webkit-overflow-scrolling:touch;
  overflow-x:hidden;
  padding:16px 12px;
  padding-top:calc(16px + env(safe-area-inset-top));
  padding-bottom:calc(16px + env(safe-area-inset-bottom));
}
.app{
  width:100%;
  max-width:720px;             /* fills iPhone nicely */
  margin-inline:auto;
  background:var(--panel);
  border:1px solid var(--stroke);
  border-radius:22px;
  box-shadow:0 10px 32px rgba(0,0,0,.35);
  overflow:hidden;
}
header{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:12px 14px;
}
.brand{display:flex; align-items:center; gap:10px}
.logoimg{height:44px; width:auto; display:block; filter: drop-shadow(0 0 10px rgba(255,43,209,.35))}
.title{font-weight:800; font-size:clamp(18px,3.4vw,26px)}

.btn{
  appearance:none; border:1px solid var(--stroke); background:rgba(255,255,255,.08); color:var(--text);
  padding:10px 14px; border-radius:14px; cursor:pointer; font-weight:700; transition:transform .08s ease, box-shadow .12s ease
}
.btn:active{transform:scale(.98)}
.btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#0b1020; border-color:transparent}

.hero{padding:6px 14px 12px}
.progress{height:8px; background:rgba(255,255,255,.08); border:1px solid var(--stroke); border-radius:999px; overflow:hidden}
.progress>i{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--accent),var(--accent2)); transition:width .35s ease}

.stage{display:grid; grid-template-columns:1fr; gap:12px; padding:10px 14px 14px}
.question{font-size:clamp(18px,3vw,22px); margin:2px 2px 4px}

.grid{
  display:grid; gap:14px;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  justify-items:center;
}
.card{
  display:flex; flex-direction:column; align-items:center;
  border:1px solid var(--stroke); background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
  border-radius:18px; width:100%; max-width:360px; padding:8px 10px 12px;
  box-shadow:0 6px 18px rgba(0,0,0,.25);
}
/* iPhone-safe, actually clickable */
.card>button{
  appearance:none; border:0; background:transparent;
  width:100%; display:flex; flex-direction:column; align-items:center;
  cursor:pointer; -webkit-tap-highlight-color:transparent; touch-action:manipulation;
  -webkit-user-select:none; user-select:none; min-height:44px;
}
.card>button:focus-visible{outline:3px solid #ffffff88; outline-offset:4px; border-radius:14px}

/* PIC tiles — 200×200 exactly */
.imgbox{
  width:200px; height:200px; margin:8px auto 6px; border-radius:16px;
  display:grid; place-items:center;
  background:
    radial-gradient(600px 200px at 50% 0%, rgba(255,255,255,.12), rgba(255,255,255,.02)),
    linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
}
.emoji{font-size:92px; line-height:1}
.label{padding:10px 6px 4px; font-weight:800; text-align:center; color:var(--muted)}

.controls{display:flex; gap:10px; justify-content:space-between; align-items:center; padding:0 2px 10px}

.results{display:none; padding:10px 14px 14px}
.results.show{display:block}
.results-grid{
  display:grid; gap:14px;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  justify-items:center;
}

footer{padding:10px 14px 14px; display:flex; justify-content:space-between; align-items:center; color:var(--muted); font-size:14px}
.kbd{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; border:1px solid var(--stroke); border-bottom-width:2px; padding:.1em .5em; border-radius:6px; background:rgba(255,255,255,.05)}

@media (max-width:560px){
  .grid,.results-grid{grid-template-columns:1fr}
  .card{max-width:420px}
}
</style>
</head>
<body>
<main class="app" id="app">
  <header>
    <div class="brand">
      <img class="logoimg" src="./logo_shensawi_neon.png" alt="شنسوي — by Fahad" onerror="this.style.display='none'"/>
      <div class="title" id="appTitle">شنسوي الويكند؟</div>
    </div>
    <button class="btn" id="resetBtn" type="button" title="إعادة البداية">↺ إعادة</button>
  </header>

  <div class="hero"><div class="progress" aria-hidden="true"><i id="bar"></i></div></div>

  <section class="stage" id="stage" aria-live="polite"></section>
  <section class="results" id="results"></section>

  <footer>
    <span class="muted">فلتر أنشطة — صور النتائج عناصر نائبة.</span>
    <span class="muted">Tip: <span class="kbd">E</span> للتحرير السريع.</span>
  </footer>
</main>

<script>
const DATA = {
  meta:{title:"شنسوي الويكند؟", rtl:true},
  questions:[
    {id:"q0_group", text:"منو المجموعة؟", options:[
      {id:"kids",   label:"أطفال",        emoji:"🧒", next:"q1_energy"},
      {id:"adults", label:"بالغين",       emoji:"🧑‍🤝‍🧑", next:"q1_energy"},
      {id:"mixed",  label:"عائلة/مختلط",  emoji:"👨‍👩‍👧‍👦", next:"q1_energy"}
    ]},
    {id:"q1_energy", text:"المود شنو تبيه؟", options:[
      {id:"chill",    label:"هادي ومريح",    emoji:"🛋️", next:"q2_place"},
      {id:"creative", label:"إبداعي/صنع شي", emoji:"🎨", next:"q2_place"},
      {id:"active",   label:"حركي وممتع",    emoji:"⚡️", next:"q2_place"}
    ]},
    {id:"q2_place", text:"وين تفضل؟", options:[
      {id:"indoor",  label:"داخل",           emoji:"🏠", next:"q3_time"},
      {id:"outdoor", label:"خارج",           emoji:"🌤️", next:"q3_time"},
      {id:"water",   label:"قريب من البحر",  emoji:"🌊", next:"q3_time"},
      {id:"city",    label:"أماكن المدينة",   emoji:"🏙️", next:"q3_time"}
    ]},
    {id:"q3_time", text:"المدّة؟", options:[
      {id:"quick",   label:"طلعة سريعة",   emoji:"⏱️", next:"result:auto"},
      {id:"twoh",    label:"حوالي ساعتين", emoji:"🕑", next:"result:auto"},
      {id:"evening", label:"سهرة كاملة",   emoji:"🌙", next:"result:auto"}
    ]}
  ],
  activities:[
    {id:"bowling",title:"بولينغ ممتع",groups:["adults","mixed","kids"],energy:"active",place:"indoor",duration:["twoh"],desc:"مسابقة سريعة بالكور والسترايك."},
    {id:"trampoline",title:"ترامبولين بارك",groups:["kids","mixed"],energy:"active",place:"indoor",duration:["twoh"],desc:"قفز وحرق طاقة."},
    {id:"escape",title:"غرفة هروب",groups:["adults","mixed"],energy:"active",place:"indoor",duration:["twoh"],desc:"ألغاز جماعية وسباق وقت."},
    {id:"laser",title:"لايزر تاج",groups:["mixed","adults","kids"],energy:"active",place:"indoor",duration:["twoh","quick"],desc:"فرق وتحديات ليزر."},
    {id:"arcade",title:"ألعاب آركيد وVR",groups:["mixed","adults","kids"],energy:"active",place:"indoor",duration:["quick","twoh"],desc:"سباقات ومحاكيات."},
    {id:"bikes",title:"دراجات/سكوترات بالممشى",groups:["mixed","adults","kids"],energy:"active",place:"outdoor",duration:["twoh","quick"],desc:"نَسَمة ونشاط خفيف."},
    {id:"kayak",title:"كاياك/قوارب",groups:["mixed","adults"],energy:"active",place:"water",duration:["twoh"],desc:"تجربة بحرية منعشة."},
    {id:"minigolf",title:"ميني غولف",groups:["mixed","adults","kids"],energy:"active",place:"outdoor",duration:["twoh","quick"],desc:"منافسات بسيطة."},
    {id:"climb",title:"تسلق جدار داخلي",groups:["mixed","adults"],energy:"active",place:"indoor",duration:["twoh"],desc:"تحدي عضلي آمن."},
    {id:"iceskate",title:"تزلج على الجليد",groups:["mixed","adults","kids"],energy:"active",place:"indoor",duration:["twoh","quick"],desc:"لفّات ممتعة."},
    {id:"cinema",title:"سينما",groups:["mixed","adults"],energy:"chill",place:"indoor",duration:["twoh","evening"],desc:"موفي نايت."},
    {id:"corniche",title:"مشية على الكورنيش",groups:["mixed","adults","kids"],energy:"chill",place:"water",duration:["quick","twoh"],desc:"هواء بحر."},
    {id:"beachsunset",title:"شاطئ وقت الغروب",groups:["mixed","adults","kids"],energy:"chill",place:"water",duration:["evening"],desc:"ألوان الغروب."},
    {id:"parkplay",title:"حديقة وملاعب",groups:["kids","mixed"],energy:"chill",place:"outdoor",duration:["twoh","quick"],desc:"ألعاب وركض."},
    {id:"boardcafe",title:"جلسة ألعاب لوحية",groups:["mixed","adults","kids"],energy:"chill",place:"indoor",duration:["twoh"],desc:"كاتان/أونو."},
    {id:"library",title:"مكتبة/قراءة",groups:["adults","mixed"],energy:"chill",place:"indoor",duration:["quick","twoh"],desc:"قهوة وكتاب."},
    {id:"stargaze",title:"تأمل نجوم",groups:["mixed","adults","kids"],energy:"chill",place:"outdoor",duration:["evening"],desc:"سماء صافية."},
    {id:"desertcoffee",title:"قعدة صحراوية",groups:["mixed","adults"],energy:"chill",place:"outdoor",duration:["evening"],desc:"نار وقهوة."},
    {id:"yoga",title:"يوغا/استرخاء",groups:["adults","mixed"],energy:"chill",place:"indoor",duration:["quick","twoh"],desc:"تنفّس ومرونة."},
    {id:"paint",title:"ورشة رسم/تلوين",groups:["mixed","adults","kids"],energy:"creative",place:"indoor",duration:["twoh","quick"],desc:"ألوان ولوحات."},
    {id:"pottery",title:"خزف وفخار",groups:["adults","mixed"],energy:"creative",place:"indoor",duration:["twoh"],desc:"عجلة وتلوين."},
    {id:"science",title:"مركز علوم/تجارب",groups:["kids","mixed"],energy:"creative",place:"indoor",duration:["twoh"],desc:"تعليم ممتع."},
    {id:"cityphoto",title:"جولة تصوير",groups:["adults","mixed"],energy:"creative",place:"city",duration:["twoh"],desc:"ستريت فوتو."},
    {id:"sandart",title:"فن بالرمل",groups:["kids"],energy:"creative",place:"indoor",duration:["twoh","quick"],desc:"آمنة للصغار."},
    {id:"mirrors",title:"متاهة مرايا/رعب",groups:["mixed","adults","kids"],energy:"creative",place:"indoor",duration:["quick"],desc:"تجربة حسّية."},
    {id:"cook",title:"ورشة طبخ عائلية",groups:["mixed"],energy:"creative",place:"indoor",duration:["twoh"],desc:"وصفة سهلة."},
    {id:"craftmarket",title:"سوق حرفي",groups:["adults","mixed"],energy:"creative",place:"city",duration:["twoh","quick"],desc:"منتجات فنية."}
  ]
};

/* ---------- State ---------- */
const stageEl = document.getElementById('stage');
const resultsEl = document.getElementById('results');
const barEl = document.getElementById('bar');
const resetBtn = document.getElementById('resetBtn');
const titleEl = document.getElementById('appTitle');

let answers=[]; let currentQ=DATA.questions[0].id;
const qIndexById = Object.fromEntries(DATA.questions.map((q,i)=>[q.id,i]));

document.documentElement.dir = DATA.meta?.rtl===false ? 'ltr' : 'rtl';
titleEl.textContent = DATA.meta?.title || titleEl.textContent;

/* ---------- Render ---------- */
function render(){
  resultsEl.classList.remove('show');
  stageEl.innerHTML='';
  const q = DATA.questions[qIndexById[currentQ]];
  if(!q){ return showResults(); }

  const step = qIndexById[currentQ]+1;
  const total = DATA.questions.length;
  barEl.style.width = Math.round((step-1)/total*100)+'%';

  const qEl = document.createElement('div');
  qEl.className='question';
  qEl.textContent=q.text;
  stageEl.appendChild(qEl);

  const grid=document.createElement('div'); grid.className='grid';

  q.options.forEach(opt=>{
    const card=document.createElement('div'); card.className='card';
    const btn=document.createElement('button'); btn.type='button'; btn.setAttribute('aria-label', opt.label);
    btn.addEventListener('click', ()=>select(opt), {passive:true});

    const img=document.createElement('div'); img.className='imgbox';
    img.innerHTML=`<span class="emoji">${opt.emoji||'⭐'}</span>`;
    const lab=document.createElement('div'); lab.className='label'; lab.textContent=opt.label;

    btn.appendChild(img); btn.appendChild(lab);
    card.appendChild(btn);
    grid.appendChild(card);
  });

  stageEl.appendChild(grid);

  const ctr=document.createElement('div'); ctr.className='controls';
  const back=document.createElement('button'); back.className='btn'; back.textContent='رجوع'; back.disabled=answers.length===0;
  back.addEventListener('click', goBack);
  const skip=document.createElement('button'); skip.className='btn'; skip.textContent='تخطي';
  skip.addEventListener('click', ()=>{
    answers.push({q:q.id,o:null});
    advance(q,{next:q.options[0]?.next||null});
  });
  ctr.appendChild(back); ctr.appendChild(skip);
  stageEl.appendChild(ctr);
}

function select(opt){
  const q = DATA.questions[qIndexById[currentQ]];
  answers.push({q:q.id,o:opt.id});
  advance(q,opt);
}

function advance(q,opt){
  const nxt=opt.next||null;
  if(nxt && nxt.startsWith('result:auto')) showResults();
  else if(nxt){ currentQ=nxt; render(); }
  else showResults();
}

function goBack(){
  if(!answers.length) return;
  answers.pop();
  const prev = answers.length ? answers[answers.length-1].q : DATA.questions[0].id;
  currentQ = prev; render();
}

/* ---------- Results ---------- */
function showResults(){
  stageEl.innerHTML='';
  barEl.style.width='100%';

  const prefs={
    group:getAnswer('q0_group'),
    energy:getAnswer('q1_energy'),
    place:getAnswer('q2_place'),
    time:getAnswer('q3_time')
  };

  const scored = DATA.activities.map(a=>{
    if(prefs.group && !a.groups.includes(prefs.group)) return null;
    let s=0;
    if(prefs.energy && a.energy===prefs.energy) s+=3;
    if(prefs.place){
      if(a.place===prefs.place) s+=3;
      else if((prefs.place==='water' && a.place==='outdoor')||(prefs.place==='outdoor' && a.place==='water')) s+=1;
      else if(prefs.place==='city' && (a.place==='indoor'||a.place==='outdoor')) s+=1;
    }
    if(prefs.time && a.duration?.includes(prefs.time)) s+=2;
    if(prefs.group==='mixed' && a.groups.includes('kids')) s+=1;
    return {a, s};
  }).filter(Boolean).sort((x,y)=>y.s-x.s);

  const picks = scored.slice(0, Math.max(3, Math.min(6, scored.length))).map(x=>x.a);
  resultsEl.innerHTML='';
  const title=document.createElement('div'); title.className='question'; title.textContent='اقتراحات تناسب اختياراتك';
  const grid=document.createElement('div'); grid.className='results-grid';

  (picks.length ? picks : DATA.activities.slice(0,3)).forEach(item=>{
    const card=document.createElement('div'); card.className='card';
    const img=document.createElement('div'); img.className='imgbox'; img.innerHTML=`<span class="emoji">✨</span>`;
    const lab=document.createElement('div'); lab.className='label'; lab.innerHTML=`<div style="font-weight:800">${escapeHTML(item.title)}</div><div class="muted" style="font-weight:500">${escapeHTML(item.desc||'')}</div>`;
    card.appendChild(img); card.appendChild(lab);
    grid.appendChild(card);
  });

  resultsEl.appendChild(title);
  resultsEl.appendChild(grid);
  const ctr=document.createElement('div'); ctr.className='controls';
  const again=document.createElement('button'); again.className='btn primary'; again.textContent='ابدأ من جديد'; again.addEventListener('click', reset);
  const tweak=document.createElement('button'); tweak.className='btn'; tweak.textContent='تعديل الاختيارات'; tweak.addEventListener('click', ()=>goBack());
  ctr.appendChild(again); ctr.appendChild(tweak);
  resultsEl.appendChild(ctr);

  resultsEl.classList.add('show');
}

function getAnswer(qid){
  const found=[...answers].reverse().find(x=>x.q===qid && x.o!==null);
  return found?found.o:null;
}
function reset(){ answers=[]; currentQ=DATA.questions[0].id; render(); }
resetBtn.addEventListener('click', reset);

/* quick text edit mode */
let edit=false;
window.addEventListener('keydown',e=>{
  if(e.key.toLowerCase()==='e'){
    edit=!edit; alert(edit?'وضع التحرير السريع: اضغط على النصوص لتعديلها.':'تم إيقاف وضع التحرير.');
  }
});
stageEl.addEventListener('click',e=>{
  if(!edit) return; const el=e.target.closest('.label'); if(!el) return;
  const current=el.textContent.trim(); const next=prompt('حرّر النص:', current);
  if(next!==null) el.textContent=next;
});

function escapeHTML(s){
  return (s||'').replace(/[&<>\"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
  }[m]));
}

document.addEventListener('DOMContentLoaded',render);
</script>
</body>
</html>
